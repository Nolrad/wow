<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Guide Joaillerie 1-300 sans achat HV - WoW TBC Classic</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS global (TOUT le style est dans assets) -->
    <link rel="stylesheet" href="../assets/css/site.css">
</head>

<body>
<!-- Navbar injectée par ../assets/js/nav.js -->

<header class="page-header">
    <h1>Joaillerie 1-300 sans achat HV</h1>
    <p>Basé sur le guide WowIsClassic, adapté pour tout farmer soi-même (minage + drops) en TBC Classic / pré-patch.</p>
</header>

<main class="container">
    <section class="card">
        <h2>Vue d'ensemble</h2>
        <p>
            Ce guide suit la route <strong>1-300</strong> de WowIsClassic, en supposant que tu ne veux
            <strong>rien acheter à l'HV</strong> : tu mines tes minerais, tu prospectes pour les gemmes
            et tu farms les composants qui tombent sur les monstres.
        </p>
        <p>Métiers conseillés&nbsp;:</p>
        <ul>
            <li><span class="tag">Joaillerie</span><span class="tag">Minage</span></li>
        </ul>
        <p>
            L'objectif est d'arriver 300 en <strong>minimisant les coûts</strong>, en utilisant surtout
            ce que tu loot / mines pendant ton leveling (Paladin Elfe de Sang Horde par exemple).
        </p>
    </section>

    <section class="card">
        <h2>Matériaux à prévoir 1-300 (liste du guide, orientée farm perso)</h2>

        <h3>Matériaux issus du minage / prospection</h3>
        <table>
            <thead>
                <tr>
                    <th>Ressource</th>
                    <th>Quantité</th>
                    <th>Origine</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Barre de cuivre</td>
                    <td>40</td>
                    <td class="origin-mining">Minerai de cuivre → fonderie</td>
                </tr>
                <tr>
                    <td>Pierre brute</td>
                    <td>80</td>
                    <td class="origin-mining">Sous-produit du cuivre / étain</td>
                </tr>
                <tr>
                    <td>Barre de bronze</td>
                    <td>80</td>
                    <td class="origin-mining">Barre de cuivre + barre d'étain</td>
                </tr>
                <tr>
                    <td>Barre d'argent</td>
                    <td>50</td>
                    <td class="origin-mining">Minerai d'argent → fonderie</td>
                </tr>
                <tr>
                    <td>Pierre lourde</td>
                    <td>80</td>
                    <td class="origin-mining">Sous-produit du fer</td>
                </tr>
                <tr>
                    <td>Barre de mithril</td>
                    <td>100</td>
                    <td class="origin-mining">Minerai de mithril → fonderie</td>
                </tr>
                <tr>
                    <td>Barre de vrai-argent</td>
                    <td>60</td>
                    <td class="origin-mining">Minerai de vrai-argent → fonderie</td>
                </tr>
                <tr>
                    <td>Barre de thorium</td>
                    <td>50</td>
                    <td class="origin-mining">Minerai de thorium → fonderie</td>
                </tr>
                <tr>
                    <td>Oeil de tigre</td>
                    <td>20</td>
                    <td class="origin-mining">Prospection cuivre</td>
                </tr>
                <tr>
                    <td>Agate mousse</td>
                    <td>30</td>
                    <td class="origin-mining">Prospection étain / fer (ou drops)</td>
                </tr>
                <tr>
                    <td>Citrine</td>
                    <td>10</td>
                    <td class="origin-mining">Prospection fer / mithril</td>
                </tr>
                <tr>
                    <td>Aigue-marine</td>
                    <td>45</td>
                    <td class="origin-mining">Prospection fer / mithril</td>
                </tr>
                <tr>
                    <td>Rubis étoilé</td>
                    <td>5</td>
                    <td class="origin-mining">Prospection thorium</td>
                </tr>
                <tr>
                    <td>Grande opale</td>
                    <td>10</td>
                    <td class="origin-mining">Prospection thorium</td>
                </tr>
                <tr>
                    <td>Saphir bleu</td>
                    <td>40</td>
                    <td class="origin-mining">Prospection thorium</td>
                </tr>
                <tr>
                    <td>Diamant d'Azeroth</td>
                    <td>5</td>
                    <td class="origin-mining">Prospection thorium</td>
                </tr>
                <tr>
                    <td>Énorme émeraude</td>
                    <td>20</td>
                    <td class="origin-mining">Prospection thorium</td>
                </tr>
            </tbody>
        </table>

        <h3>Matériaux à looter (pas d'achat HV)</h3>
        <table>
            <thead>
                <tr>
                    <th>Ressource</th>
                    <th>Quantité</th>
                    <th>Origine suggérée</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Eau élémentaire</td>
                    <td>20</td>
                    <td class="origin-drop">Élémentaires d'eau (Marais, Tanaris, etc.)</td>
                </tr>
                <tr>
                    <td>Flacon de mojo</td>
                    <td>60</td>
                    <td class="origin-drop">Trolls, humanoïdes haut niveau</td>
                </tr>
                <tr>
                    <td>Coeur de fauve</td>
                    <td>20</td>
                    <td class="origin-drop">Bêtes haut niveau (Gangrebois, Winterspring...)</td>
                </tr>
            </tbody>
        </table>

        <div class="row" style="margin-top: 12px;">
            <button id="save-stock" class="btn-primary">Enregistrer mon stock (TXT)</button>
            <button id="export-json" class="btn-secondary">Exporter JSON</button>
            <button id="export-csv" class="btn-secondary">Exporter CSV</button>

            <label class="import-label">
                Importer stock (JSON/TXT)
                <input id="import-file" type="file" accept=".json,.txt" style="display:none;">
            </label>

            <button id="reset-stock" class="btn-danger">Reset stock</button>
        </div>

        <p class="hint">
            Le stock est mémorisé dans le navigateur (localStorage). Tu peux exporter en TXT/JSON/CSV et réimporter.
        </p>

        <p>
            <strong>Important :</strong> si tu veux vraiment ne rien acheter, prévois de
            <strong>garder tous tes minerais / pierres</strong> et de farmer ces composants en même temps
            que ton leveling 40+.
        </p>
    </section>

    <section class="card">
        <h2>Route 1-300 étape par étape (adaptée farm perso)</h2>

        <h3 class="range">1 → 20</h3>
        <p><strong>Créer 20 × Fil de cuivre délicat</strong></p>
        <ul>
            <li><span class="route-ressource" data-ressource="Barre de cuivre">40 × Barre de cuivre</span></li>
        </ul>

        <h3 class="range">20 → 30</h3>
        <p><strong>Créer 10 × Statue en pierre brute</strong></p>
        <ul>
            <li><span class="route-ressource" data-ressource="Pierre brute">80 × Pierre brute</span></li>
        </ul>

        <h3 class="range">30 → 50</h3>
        <p><strong>Créer 20 × Bague d'oeil de tigre</strong></p>
        <ul>
            <li>20 × Fil de cuivre délicat (garde les 20 craftés au début)</li>
            <li><span class="route-ressource" data-ressource="Oeil de tigre">20 × Oeil de tigre (prospection cuivre)</span></li>
        </ul>

        <h3 class="range">50 → 75</h3>
        <p><strong>Créer 30 × Monture en bronze</strong></p>
        <ul>
            <li><span class="route-ressource" data-ressource="Barre de bronze">60 × Barre de bronze</span></li>
        </ul>
        <p class="hint">Garde ces montures pour plus tard (120-150).</p>

        <h3 class="range">75 → 80</h3>
        <p><strong>Créer 5 × Anneau solide en bronze</strong></p>
        <ul>
            <li><span class="route-ressource" data-ressource="Barre de bronze">20 × Barre de bronze</span></li>
        </ul>

        <h3 class="range">80 → 90</h3>
        <p><strong>Créer 10 × Anneau d'argent élégant</strong></p>
        <ul>
            <li><span class="route-ressource" data-ressource="Barre d'argent">10 × Barre d'argent</span></li>
        </ul>

        <h3 class="range">90 → 110</h3>
        <p><strong>Créer 20 × Anneau du pouvoir argenté</strong></p>
        <ul>
            <li><span class="route-ressource" data-ressource="Barre d'argent">40 × Barre d'argent</span></li>
        </ul>

        <h3 class="range">110 → 120</h3>
        <p><strong>Créer 10 × Statue en pierre lourde</strong></p>
        <ul>
            <li><span class="route-ressource" data-ressource="Pierre lourde">80 × Pierre lourde</span></li>
        </ul>

        <h3 class="range">120 → 150</h3>
        <p><strong>Créer 30 × Pendentif du bouclier d'agate</strong></p>
        <ul>
            <li>30 × Monture en bronze (garde celles faites 50-75 + complète au besoin)</li>
            <li><span class="route-ressource" data-ressource="Agate mousse">30 × Agate mousse (prospection étain / fer ou drops)</span></li>
        </ul>

        <h3 class="range">150 → 180</h3>
        <p><strong>Créer 30 × Filigrane en mithril</strong></p>
        <ul>
            <li><span class="route-ressource" data-ressource="Barre de mithril">60 × Barre de mithril</span></li>
        </ul>

        <h3 class="range">180 → 200</h3>
        <p><strong>Créer 20 × Anneau ciselé en vrai-argent</strong></p>
        <ul>
            <li><span class="route-ressource" data-ressource="Barre de vrai-argent">20 × Barre de vrai-argent</span></li>
            <li>40 × Filigrane en mithril (faits juste avant)</li>
        </ul>

        <h3 class="range">200 → 210</h3>
        <p><strong>Créer 10 × Anneau de citrine de soin accéléré</strong></p>
        <ul>
            <li><span class="route-ressource" data-ressource="Citrine">10 × Citrine</span></li>
            <li><span class="route-ressource" data-ressource="Barre de mithril">20 × Barre de mithril</span></li>
            <li><span class="route-ressource" data-ressource="Eau élémentaire">20 × Eau élémentaire (farm élémentaires)</span></li>
        </ul>

        <h3 class="range">210 → 225</h3>
        <p><strong>Créer 15 × Chevalière d'aigue-marine</strong></p>
        <ul>
            <li><span class="route-ressource" data-ressource="Aigue-marine">45 × Aigue-marine</span></li>
            <li><span class="route-ressource" data-ressource="Flacon de mojo">60 × Flacon de mojo (farm trolls / humanoïdes)</span></li>
        </ul>

        <h3 class="range">225 → 250</h3>
        <p><strong>Créer 25 × Monture en thorium</strong></p>
        <ul>
            <li><span class="route-ressource" data-ressource="Barre de thorium">25 × Barre de thorium</span></li>
        </ul>

        <h3 class="range">250 → 255</h3>
        <p><strong>Créer 5 × Bague de destruction rouge</strong></p>
        <ul>
            <li><span class="route-ressource" data-ressource="Rubis étoilé">5 × Rubis étoilé</span></li>
            <li>5 × Monture en thorium</li>
        </ul>

        <h3 class="range">255 → 265</h3>
        <p><strong>Créer 10 × Anneau de soin en vrai-argent</strong></p>
        <ul>
            <li><span class="route-ressource" data-ressource="Barre de vrai-argent">20 × Barre de vrai-argent</span></li>
            <li><span class="route-ressource" data-ressource="Coeur de fauve">20 × Coeur de fauve (farm bêtes)</span></li>
        </ul>

        <h3 class="range">265 → 275</h3>
        <p><strong>Créer 10 × Anneau d'opale simple</strong></p>
        <ul>
            <li>10 × Monture en thorium</li>
            <li><span class="route-ressource" data-ressource="Grande opale">10 × Grande opale</span></li>
        </ul>

        <h3 class="range">275 → 285</h3>
        <p><strong>Créer 10 × Chevalière de saphir</strong></p>
        <ul>
            <li><span class="route-ressource" data-ressource="Saphir bleu">40 × Saphir bleu</span></li>
            <li><span class="route-ressource" data-ressource="Barre de vrai-argent">20 × Barre de vrai-argent</span></li>
            <li>10 × Monture en thorium</li>
        </ul>

        <h3 class="range">285 → 290</h3>
        <p><strong>Créer 5 × Bague à diamant de focalisation</strong></p>
        <ul>
            <li><span class="route-ressource" data-ressource="Diamant d'Azeroth">5 × Diamant d'Azeroth</span></li>
            <li>5 × Monture en thorium</li>
        </ul>

        <h3 class="range">290 → 300</h3>
        <p><strong>Créer 10 × Anneau d'émeraude du lion</strong></p>
        <ul>
            <li><span class="route-ressource" data-ressource="Énorme émeraude">20 × Énorme émeraude</span></li>
            <li>10 × Monture en thorium</li>
        </ul>
    </section>

    <section class="card">
        <h2>Conseils spécial “je farm tout moi-même”</h2>
        <ul>
            <li><strong>Ne vends jamais minerais / pierres</strong> avant d'être 300 Joaillerie.</li>
            <li>Utilise ton <strong>Paladin</strong> pour farm en AoE les trolls / bêtes pour le mojo, les coeurs de fauve, etc.</li>
            <li>Prospecte systématiquement tes minerais dès que tu as un petit stock.</li>
            <li>Si un palier te semble trop cher, garde tes crafts verts/jaunes un peu plus longtemps.</li>
        </ul>
    </section>

    <div class="footer">
        Guide Joaillerie 1-300 (farm perso, minage + drops) — inspiré de WowIsClassic
    </div>
</main>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const STORAGE_KEY = 'joaillerie_stock';

    function downloadFile(filename, content, mime) {
        const blob = new Blob([content], { type: mime });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    // Ajoute les colonnes "Tu as" et "Manque" à chaque tableau
    function enhanceTables() {
        const tables = document.querySelectorAll('table');

        tables.forEach(function (table) {
            if (!table.tHead || !table.tBodies.length) return;

            const headerRow = table.tHead.rows[0];

            // Evite double ajout si reload/SPA
            const headers = Array.from(headerRow.cells).map(th => th.textContent.trim().toLowerCase());
            if (headers.includes('tu as') || headers.includes('manque')) return;

            const thOwned = document.createElement('th');
            thOwned.textContent = 'Tu as';
            const thMissing = document.createElement('th');
            thMissing.textContent = 'Manque';

            headerRow.appendChild(thOwned);
            headerRow.appendChild(thMissing);

            Array.from(table.tBodies[0].rows).forEach(function (row) {
                const resName = row.cells[0].textContent.trim();
                const required = parseInt(row.cells[1].textContent.trim(), 10) || 0;

                // Colonne "Tu as"
                const tdOwned = document.createElement('td');
                const input = document.createElement('input');
                input.type = 'number';
                input.min = '0';
                input.className = 'input-owned';
                input.dataset.ressource = resName;
                input.dataset.required = required;
                tdOwned.appendChild(input);
                row.appendChild(tdOwned);

                // Colonne "Manque"
                const tdMissing = document.createElement('td');
                const span = document.createElement('span');
                span.className = 'missing';
                tdMissing.appendChild(span);
                row.appendChild(tdMissing);
            });
        });
    }

    function updateRouteForResource(resourceName, isOk) {
        document.querySelectorAll('.route-ressource').forEach(function (el) {
            if (el.dataset.ressource === resourceName) {
                if (isOk) el.classList.add('route-ok');
                else el.classList.remove('route-ok');
            }
        });
    }

    function updateMissingForInput(input) {
        const required = parseInt(input.dataset.required, 10) || 0;
        const owned = parseInt(input.value, 10) || 0;
        const missing = Math.max(required - owned, 0);

        const row = input.closest('tr');
        const span = row ? row.querySelector('span.missing') : null;
        if (span) span.textContent = missing > 0 ? missing : 'OK';

        updateRouteForResource(input.dataset.ressource, missing === 0);
    }

    function updateAllMissing() {
        document.querySelectorAll('input.input-owned').forEach(updateMissingForInput);
    }

    function loadStock() {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) { updateAllMissing(); return; }

        let data;
        try { data = JSON.parse(raw); } catch { updateAllMissing(); return; }
        if (!data || typeof data !== 'object') { updateAllMissing(); return; }

        document.querySelectorAll('input.input-owned').forEach(function (input) {
            const name = input.dataset.ressource;
            if (Object.prototype.hasOwnProperty.call(data, name)) {
                input.value = data[name];
            }
        });

        updateAllMissing();
    }

    function collectItems() {
        const items = [];
        document.querySelectorAll('input.input-owned').forEach(function (input) {
            const name = input.dataset.ressource;
            const required = parseInt(input.dataset.required, 10) || 0;
            const owned = parseInt(input.value, 10) || 0;
            const missing = Math.max(required - owned, 0);
            items.push({ name, required, owned, missing });
        });
        return items;
    }

    function saveStockToLocalStorage() {
        const data = {};
        document.querySelectorAll('input.input-owned').forEach(function (input) {
            const name = input.dataset.ressource;
            const owned = parseInt(input.value, 10) || 0;
            data[name] = owned;
        });
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    // === Exports ===
    function exportTXT() {
        const items = collectItems();
        saveStockToLocalStorage();
        const lines = items.map(it => `${it.name} ; requis=${it.required} ; possédé=${it.owned} ; manque=${it.missing}`);
        downloadFile('stock_joaillerie.txt', lines.join("\n"), 'text/plain;charset=utf-8');
    }

    function exportJSON() {
        const payload = {
            version: 1,
            exported_at: new Date().toISOString(),
            items: collectItems()
        };
        saveStockToLocalStorage();
        downloadFile('stock_joaillerie.json', JSON.stringify(payload, null, 2), 'application/json;charset=utf-8');
    }

    function exportCSV() {
        const items = collectItems();
        saveStockToLocalStorage();
        const header = "ressource;requis;possede;manque\n";
        const rows = items.map(it => `${it.name};${it.required};${it.owned};${it.missing}`).join("\n");
        downloadFile('stock_joaillerie.csv', header + rows, 'text/csv;charset=utf-8');
    }

    // === Import ===
    function applyOwnedMap(ownedMap) {
        document.querySelectorAll('input.input-owned').forEach(function (input) {
            const name = input.dataset.ressource;
            if (Object.prototype.hasOwnProperty.call(ownedMap, name)) {
                input.value = ownedMap[name];
            }
        });
        localStorage.setItem(STORAGE_KEY, JSON.stringify(ownedMap));
        updateAllMissing();
    }

    function importFromJSONText(text) {
        const data = JSON.parse(text);

        // Format payload {items:[{name, owned,...}]}
        if (data && Array.isArray(data.items)) {
            const ownedMap = {};
            data.items.forEach(function (it) {
                if (it && typeof it.name === 'string') {
                    ownedMap[it.name] = parseInt(it.owned, 10) || 0;
                }
            });
            applyOwnedMap(ownedMap);
            return;
        }

        // Format simple {"Barre de cuivre": 12, ...}
        if (data && typeof data === 'object') {
            const ownedMap = {};
            Object.keys(data).forEach(k => ownedMap[k] = parseInt(data[k], 10) || 0);
            applyOwnedMap(ownedMap);
            return;
        }

        alert("JSON non reconnu.");
    }

    function importFromTxt(text) {
        // Supporte ton format TXT :
        // "Ressource ; requis=40 ; possédé=12 ; manque=28"
        const ownedMap = {};
        const lines = text.split(/\r?\n/).map(l => l.trim()).filter(Boolean);

        lines.forEach(function (line) {
            const parts = line.split(";");
            if (!parts.length) return;

            const name = (parts[0] || "").trim();
            let owned = null;

            parts.slice(1).forEach(function (p) {
                const chunk = (p || "").trim();
                if (chunk.startsWith("possédé=") || chunk.startsWith("possede=")) {
                    const v = chunk.split("=")[1];
                    const n = parseInt(v, 10);
                    if (!Number.isNaN(n)) owned = n;
                }
            });

            if (name && owned !== null) ownedMap[name] = Math.max(owned, 0);
        });

        applyOwnedMap(ownedMap);
    }

    // === Reset ===
    function resetStock() {
        if (!confirm("Reset du stock ? (efface la sauvegarde navigateur)")) return;
        localStorage.removeItem(STORAGE_KEY);
        document.querySelectorAll('input.input-owned').forEach(input => input.value = "");
        updateAllMissing();
    }

    // Init
    enhanceTables();
    loadStock();

    // Live update
    document.addEventListener('input', function (e) {
        if (e.target && e.target.matches('input.input-owned')) {
            updateMissingForInput(e.target);
            saveStockToLocalStorage();
        }
    });

    // Buttons
    const saveBtn = document.getElementById('save-stock');
    if (saveBtn) saveBtn.addEventListener('click', exportTXT);

    const exportJsonBtn = document.getElementById('export-json');
    if (exportJsonBtn) exportJsonBtn.addEventListener('click', exportJSON);

    const exportCsvBtn = document.getElementById('export-csv');
    if (exportCsvBtn) exportCsvBtn.addEventListener('click', exportCSV);

    const resetBtn = document.getElementById('reset-stock');
    if (resetBtn) resetBtn.addEventListener('click', resetStock);

    const importInput = document.getElementById('import-file');
    if (importInput) {
        importInput.addEventListener('change', function () {
            const file = importInput.files && importInput.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function () {
                const text = String(reader.result || "");
                const name = file.name.toLowerCase();

                try {
                    if (name.endsWith('.json')) importFromJSONText(text);
                    else if (name.endsWith('.txt')) importFromTxt(text);
                    else alert("Format non supporté (utilise .json ou .txt).");
                } catch (e) {
                    alert("Erreur import : " + e);
                }

                importInput.value = "";
            };
            reader.readAsText(file, 'utf-8');
        });
    }
});
</script>

<!-- Navbar -->
<script src="../assets/js/nav.js"></script>
</body>
</html>
